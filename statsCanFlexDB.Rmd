---
title: "Statistics Canada"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
runtime: shiny 
csl: biomed-central.csl
---

```{r setup, include=FALSE}
library(flexdashboard)
library(readr)
library(plotly)
library(dplyr)

df <- read_csv("data/commodityPrices.csv")
index <- read_csv("data/commodityIndex_1985.csv")
print(glimpse(df))
print(glimpse(index))


```
Farm Product Prices
===================================== 

Inputs {.sidebar data-width=250}
-------------------------------------

```{r global-info}
includeMarkdown("statsCanInfo.md")
hr()
```

```{r commodity-inputs}
includeMarkdown("commodityInfo.md")


```

Row {data-height=500}
-----------------------------------------------------------------------


Column {data-width=500}
-----------------------------------------------------------------------

### Index of Farm Product Prices by Largest Provinces (All Provinces 1985=100)

```{r}
selectInput("commodity",label="Choose Product", choices=index$CAL )
output$farmProduct_ts <- renderPlotly({
  print(input$commodity)
  df %>% 
  group_by(GEO) %>% 
  filter(CAL==input$commodity) %>% ## issue with milk as no baseindex
  left_join(index) %>% 
  mutate(index=round(100*Value/baseValue,1)) %>% 
  plot_ly() %>% 
  add_lines(x=~Ref_Date, y=~index,color=~GEO) %>% 
    layout(margin=list(b=120),
           xaxis=list(title=""),
           title="Pan/Zoom/Hover. Legend Entries are Toggable") %>% 
   config(displayModeBar = F,showLink = F)
})

plotlyOutput("farmProduct_ts")

```

Column {data-width=500 .tabset}
-----------------------------------------------------------------------

###  Meat & Poultry Prices $/kg - Ontario  

```{r}


 meat <- c("Cattle","Calves","Lambs","Hogs","Chickens","Turkeys")
renderPlotly({
 

 df %>% 
  filter(CAL %in% meat &GEO=="Ontario"&Ref_Date>="1985/01") %>% 
  mutate(perKilo=ifelse(CAL=="Chickens"|CAL=="Turkeys",Value,Value*2.20462/100)) %>% 
  group_by(CAL) %>% 
  plot_ly() %>% 
  add_lines(x=~Ref_Date, y=~perKilo,color=~CAL) %>% 
    layout(
      title="Pan/Zoom/Hover. Legend Entries are Toggable")
    

})
```

### Data

```{r}


 meat <- c("Cattle","Calves","Lambs","Hogs","Chickens","Turkeys")

DT::renderDataTable ({
 
 df %>% 
  filter(CAL %in% meat &GEO=="Ontario"&Ref_Date>="1985/01") %>% 
  mutate(perKilo=ifelse(CAL=="Chickens"|CAL=="Turkeys",Value,Value*2.20462/100)) %>% 
  #group_by(CAL) %>% 
 DT::datatable(class='compact stripe hover row-border order-column',rownames=FALSE,
               extensions = 'Buttons',
               options= list(paging = FALSE, searching = TRUE,info=FALSE,
                             dom = 'Bfrtip',
    buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
     deferRender = TRUE,
  scrollY = 400,
  scroller = TRUE))

})
```

Row {data-height=500}
-----------------------------------------------------------------------

### Highlights


Some other area
===================================== 

Inputs {.sidebar data-width=250}
-------------------------------------

```{r}
includeMarkdown("statsCanInfo.md")
hr()
```

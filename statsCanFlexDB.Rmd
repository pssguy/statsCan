---
title: "Statistics Canada"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
runtime: shiny 
csl: biomed-central.csl
---

```{r setup, include=FALSE}
library(flexdashboard)
library(readr)
library(plotly)
library(dplyr)

df <- read_csv("data/commodityPrices.csv")
index <- read_csv("data/commodityIndex_1985.csv")
print(glimpse(df))
print(glimpse(index))


```
Farm Product Prices
===================================== 

Inputs {.sidebar data-width=250}
-------------------------------------

```{r global-info}
includeMarkdown("statsCanInfo.md")
hr()
```

```{r commodity-inputs}
includeMarkdown("commodityInfo.md")
selectInput("commodity",label="Choose Product", choices=index$CAL )

```

Column {data-width=350}
-----------------------------------------------------------------------

### Index of Commodity Prices by Largest Provinces (All Provinces 1985=100)

```{r}

output$farmProduct_ts <- renderPlotly({
  print(input$commodity)
  df %>% 
  group_by(GEO) %>% 
  filter(CAL==input$commodity) %>% ## issue with milk as no baseindex
  left_join(index) %>% 
  mutate(index=round(100*Value/baseValue,1)) %>% 
  plot_ly() %>% 
  add_lines(x=~Ref_Date, y=~index,color=~GEO) %>% 
    layout(margin=list(b=120),
           xaxis=list(title=""),
           title="Pan/Zoom/Hover. Legend Entries are Toggable") %>% 
   config(displayModeBar = F,showLink = F)
})

plotlyOutput("farmProduct_ts")

```

Some other area
===================================== 

Inputs {.sidebar data-width=250}
-------------------------------------

```{r}
includeMarkdown("statsCanInfo.md")
hr()
```
